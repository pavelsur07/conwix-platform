# ADR-0001: Структура monorepo и размещение React внутри Symfony

- **Статус:** Accepted
- **Дата:** 2025-12-28
- **Проект:** Conwix (conwix-platform)
- **Контекст версии:** Project Reset v1

---

## 1. Контекст

На старте Conwix мы ведём разработку в **одном репозитории (monorepo)**, чтобы:

- ускорить MVP и интеграцию сервисов,
- держать инфраструктуру, realtime и приложение в одном месте,
- снизить операционные издержки (CI/CD, деплой, окружения).

Приложение строится на **Symfony + Twig**, а React используется **точечно** (только Chat Center и BotFlow).
Realtime реализуется отдельным сервисом (Socket.IO), но также хранится в этом же репозитории.

---

## 2. Решение

### 2.1. Корневая структура репозитория

В репозитории используется следующая структура:

conwix-platform/
app/ # основное приложение (Symfony + Twig + React внутри assets)
realtime/ # realtime-сервис (Node.js, Socket.IO) как отдельный сервис
infra/ # инфраструктура окружений (docker-compose, traefik, env templates)
docker/ # сборка образов (Dockerfile’ы и связанные файлы)
docs/ # документация проекта (источник истины)
README.md # краткое описание + навигация по docs

### 2.2. Правило размещения React

React размещается **внутри Symfony-приложения** в `app/assets/react/*`:

app/
assets/
react/
chat-center/
botflow/
templates/
src/

React используется **только** для:

- `chat-center`
- `botflow`

Создание отдельных корневых папок `frontend/` и `backend/` **не применяется** на старте.

---

## 3. Правила и ограничения

### 3.1. Обязательные правила структуры

1) Весь продуктовый код Symfony находится в `app/` (src, templates, config и т.д.).
2) React-код размещается **строго** в `app/assets/react/<feature>/`.
3) Запрещено создавать альтернативные структуры для React, например:
  - `app/assets/components/`
  - `app/assets/pages/`
  - `app/frontend/`
  - `app/react/`
4) Если появятся общие React-компоненты, допускается только:
  - `app/assets/react/_shared/`
    (создаётся только при реальной необходимости)

### 3.2. Разделение ответственности между infra и docker

- `infra/` отвечает за **запуск окружений и оркестрацию** (compose, traefik, env шаблоны).
- `docker/` отвечает за **сборку образов** (Dockerfile’ы и артефакты сборки).

### 3.3. Realtime как отдельный сервис

- Realtime-сервис хранится в `realtime/` как отдельная кодовая база.
- В `realtime/` запрещено размещать продуктовую бизнес-логику.
- Realtime-сервис отвечает только за доставку событий/сообщений и подключение клиентов.

---

## 4. Альтернативы (отклонены)

### A) Разделить `app/backend` и `app/frontend`

Отклонено на старте, потому что:

- увеличивает количество слоёв и папок без практической выгоды для MVP,
- усложняет onboarding и поддержку,
- React используется точечно и может жить внутри `assets`.

### B) Вынести React в отдельный репозиторий

Отклонено на старте, потому что:

- усложняет сборку и деплой,
- увеличивает стоимость CI/CD,
- не нужно для проверки гипотезы MVP.

---

## 5. Последствия

### Плюсы

- Быстрый старт MVP в одном репозитории.
- Ясная структура: app / realtime / infra / docker / docs.
- React изолирован по feature-модулям и не размазывается по проекту.

### Минусы / риски

- При росте React-части может потребоваться отдельный фронтенд-пакет/репозиторий.
- Нужна дисциплина соблюдения правила `assets/react/*`.

---

## 6. Примечание

Любые изменения структуры репозитория должны оформляться отдельным ADR
(например, ADR-000X: вынос React в отдельный package или репозиторий).
